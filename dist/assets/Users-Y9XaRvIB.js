import{A as o,L as S,E as j,c as n,v as i,f as s,g as v,F as D,j as M,t as r,n as f,e as L,M as _,N as E,P as O}from"./vendor-vMbJagej.js";import{u as P,f as z}from"./utils-BKUfGzfw.js";import{_ as I,a as w}from"./index-BQXzYUwg.js";const J={class:"users-view"},q={class:"container is-fluid"},G={class:"columns is-vcentered mb-5"},H={class:"column is-narrow"},K={class:"card glass-effect"},Q={class:"card-content"},W={key:0,class:"has-text-centered"},X={key:1,class:"table-container"},Y={class:"table is-fullwidth is-hoverable"},Z={class:"has-text-white"},ss={class:"has-text-white-ter"},es={class:"has-text-white-ter"},ts={class:"buttons are-small"},as=["onClick"],ls=["onClick","disabled"],os={class:"modal-card"},ns={class:"modal-card-head"},is={class:"modal-card-title"},ds={class:"modal-card-body"},rs={class:"field"},cs={class:"control"},us=["disabled"],ms={class:"field"},vs={class:"control"},fs={key:0,class:"field"},ps={class:"control"},hs={class:"field"},bs={class:"control"},_s=["value"],ws={class:"modal-card-foot"},ys={class:"modal-card"},gs={class:"modal-card-body"},ks={class:"modal-card-foot"},Cs=["disabled"],xs=["disabled"],Us={__name:"Users",setup(Ds){const u=P(),N=o([]),y=o(!1),g=o(!1),k=o(!1),C=o(!1),d=o(null),V=["admin","manager","user","guest"],l=S({username:"",email:"",password:"",roles:[]}),x=async()=>{y.value=!0;try{const a=await w.get("/users");N.value=a.data.data.map(e=>({...e,roles:JSON.parse(e.auth_data||"{}").roles||["user"]}))}catch{u.error("Failed to fetch users")}finally{y.value=!1}},F=async()=>{g.value=!0;try{d.value?(await w.put(`/users/${d.value.id}`,{email:l.email,roles:l.roles}),u.success("User updated successfully")):(await w.post("/users",l),u.success("User created successfully")),await x(),b()}catch(a){u.error(a.response?.data?.message||"Failed to save user")}finally{g.value=!1}},T=a=>{d.value=a,l.username=a.username,l.email=a.email,l.password="",l.roles=[...a.roles],C.value=!0},U=o(!1),p=o(null),m=o(!1),$=a=>{p.value=a,U.value=!0},A=async()=>{m.value=!0;try{await w.delete(`/users/${p.value.id}`),u.success("User deleted successfully"),await x(),h()}catch{u.error("Failed to delete user")}finally{m.value=!1}},h=()=>{U.value=!1,p.value=null,m.value=!1},b=()=>{k.value=!1,C.value=!1,d.value=null,Object.assign(l,{username:"",email:"",password:"",roles:[]})},R=a=>{switch(a){case"admin":return"is-danger";case"manager":return"is-warning";case"user":return"is-info";case"guest":return"is-dark";default:return"is-dark"}},B=a=>z(new Date(a),{addSuffix:!0});return j(()=>{x()}),(a,e)=>(i(),n("div",J,[s("div",q,[s("div",G,[e[6]||(e[6]=s("div",{class:"column"},[s("h1",{class:"title is-2 has-text-white"},[s("i",{class:"fas fa-users mr-3"}),v(" User Management ")])],-1)),s("div",H,[s("button",{class:"button is-primary",onClick:e[0]||(e[0]=t=>k.value=!0)},[...e[5]||(e[5]=[s("i",{class:"fas fa-plus mr-2"},null,-1),v(" Add User ",-1)])])])]),s("div",K,[s("div",Q,[y.value?(i(),n("div",W,[...e[7]||(e[7]=[s("i",{class:"fas fa-spinner fa-spin fa-2x has-text-white"},null,-1)])])):(i(),n("div",X,[s("table",Y,[e[10]||(e[10]=s("thead",null,[s("tr",null,[s("th",{class:"has-text-white"},"Username"),s("th",{class:"has-text-white"},"Email"),s("th",{class:"has-text-white"},"Roles"),s("th",{class:"has-text-white"},"Created"),s("th",{class:"has-text-white"},"Actions")])],-1)),s("tbody",null,[(i(!0),n(D,null,M(N.value,t=>(i(),n("tr",{key:t.id},[s("td",Z,r(t.username),1),s("td",ss,r(t.email),1),s("td",null,[(i(!0),n(D,null,M(t.roles,c=>(i(),n("span",{key:c,class:f(["tag mr-1",R(c)])},r(c),3))),128))]),s("td",es,r(B(t.created_at)),1),s("td",null,[s("div",ts,[s("button",{class:"button is-info is-outlined",onClick:c=>T(t)},[...e[8]||(e[8]=[s("i",{class:"fas fa-edit"},null,-1)])],8,as),s("button",{class:"button is-danger is-outlined",onClick:c=>$(t),disabled:t.username==="admin"},[...e[9]||(e[9]=[s("i",{class:"fas fa-trash"},null,-1)])],8,ls)])])]))),128))])])]))])])]),s("div",{class:f(["modal",{"is-active":k.value||C.value}])},[s("div",{class:"modal-background",onClick:b}),s("div",os,[s("header",ns,[s("p",is,r(d.value?"Edit User":"Create New User"),1),s("button",{class:"delete",onClick:b})]),s("section",ds,[s("div",rs,[e[11]||(e[11]=s("label",{class:"label"},"Username",-1)),s("div",cs,[_(s("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>l.username=t),class:"input",type:"text",placeholder:"Enter username",disabled:d.value},null,8,us),[[E,l.username]])])]),s("div",ms,[e[12]||(e[12]=s("label",{class:"label"},"Email",-1)),s("div",vs,[_(s("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>l.email=t),class:"input",type:"email",placeholder:"Enter email"},null,512),[[E,l.email]])])]),d.value?L("",!0):(i(),n("div",fs,[e[13]||(e[13]=s("label",{class:"label"},"Password",-1)),s("div",ps,[_(s("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>l.password=t),class:"input",type:"password",placeholder:"Enter password"},null,512),[[E,l.password]])])])),s("div",hs,[e[14]||(e[14]=s("label",{class:"label"},"Roles",-1)),s("div",bs,[(i(),n(D,null,M(V,t=>s("label",{class:"checkbox mr-4",key:t},[_(s("input",{type:"checkbox",value:t,"onUpdate:modelValue":e[4]||(e[4]=c=>l.roles=c)},null,8,_s),[[O,l.roles]]),v(" "+r(t),1)])),64))])])]),s("footer",ws,[s("button",{class:f(["button is-success",{"is-loading":g.value}]),onClick:F},r(d.value?"Update":"Create"),3),s("button",{class:"button",onClick:b},"Cancel")])])],2),s("div",{class:f(["modal",{"is-active":U.value}])},[s("div",{class:"modal-background",onClick:h}),s("div",ys,[s("header",{class:"modal-card-head"},[e[15]||(e[15]=s("p",{class:"modal-card-title"},"Confirm Deletion",-1)),s("button",{class:"delete",onClick:h})]),s("section",gs,[s("p",null,[e[16]||(e[16]=v("Are you sure you want to delete user ",-1)),s("strong",null,'"'+r(p.value?.username)+'"',1),e[17]||(e[17]=v("?",-1))]),e[18]||(e[18]=s("p",{class:"has-text-danger mt-3"},"This action cannot be undone.",-1))]),s("footer",ks,[s("button",{class:f(["button is-danger",{"is-loading":m.value}]),onClick:A,disabled:m.value}," Delete User ",10,Cs),s("button",{class:"button",onClick:h,disabled:m.value},"Cancel",8,xs)])])],2)]))}},Vs=I(Us,[["__scopeId","data-v-c22da48c"]]);export{Vs as default};
