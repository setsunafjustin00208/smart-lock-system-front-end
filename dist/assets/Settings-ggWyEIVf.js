import{A as h,L as k,B as $,E as H,c as v,v as w,f as s,g as l,M as f,N as g,F as R,j as I,n as b,t as A,u as J,e as z,S as E,U as q}from"./vendor-DfHZLmVz.js";import{_ as G,u as K,b as m}from"./index-DmEsqN_2.js";import{u as Q}from"./utils-BVVFTmOF.js";const W={class:"settings-view"},X={class:"container is-fluid"},Y={class:"columns"},Z={class:"column is-8"},ss={class:"card glass-effect mb-5"},ts={class:"card-content"},es={class:"field"},as={class:"control"},os=["disabled"],ls={class:"field"},ns={class:"control"},is=["disabled"],rs={class:"field"},ds={class:"control"},cs={class:"field is-grouped"},us={class:"control"},fs={key:0,class:"control"},ms={class:"card glass-effect mb-5"},ps={class:"card-content"},hs={class:"field"},vs={class:"control"},ws={class:"field"},gs={class:"control"},bs={class:"field"},ys={class:"control"},_s={class:"field"},Ps={class:"control"},xs=["disabled"],ks={class:"card glass-effect"},Cs={class:"card-content"},Ss={class:"field"},As={class:"checkbox has-text-white"},Es={class:"field"},Us={class:"checkbox has-text-white"},Ns={class:"column is-4"},Vs={class:"card glass-effect mb-5"},Ls={class:"card-content"},Ds={class:"content has-text-white-ter"},Fs={class:"card glass-effect"},Os={class:"card-content"},js={class:"field"},Bs={class:"field"},Ms={__name:"Settings",setup(Ts){const d=K(),n=Q(),c=h(!1),y=h(!1),_=h(!1),P=h(!1),x=h(!1),C=h("2 days 14 hours"),i=k({username:"",email:""}),o=k({currentPassword:"",newPassword:"",confirmPassword:""}),p=k({push:!0,lockAlerts:!0}),U=$(()=>o.currentPassword&&o.newPassword&&o.confirmPassword&&o.newPassword===o.confirmPassword&&o.newPassword.length>=6),N=()=>{i.username=d.user?.username||"",i.email=d.user?.email||"",c.value=!0},V=()=>{c.value=!1,i.username="",i.email=""},L=async()=>{y.value=!0;try{await m.put("/auth/profile",{username:i.username,email:i.email}),d.user.username=i.username,d.user.email=i.email,localStorage.setItem("user",JSON.stringify(d.user)),n.success("Profile updated successfully"),c.value=!1}catch(a){n.error(a.response?.data?.message||"Failed to update profile")}finally{y.value=!1}},D=async()=>{_.value=!0;try{await m.put("/auth/password",{current_password:o.currentPassword,new_password:o.newPassword}),n.success("Password changed successfully"),Object.assign(o,{currentPassword:"",newPassword:"",confirmPassword:""})}catch(a){console.log("Password change error:",a),console.log("Error response:",a.response?.data),n.error(a.response?.data?.message||"Failed to change password")}finally{_.value=!1}},S=async()=>{try{await m.put("/auth/notifications",p),n.success("Notification settings updated")}catch{n.error("Failed to update notification settings")}},F=async()=>{P.value=!0;try{const t=(await m.get("/auth/export")).data.data,e=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),u=window.URL.createObjectURL(e),r=document.createElement("a");r.href=u,r.download=`account-data-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(u),n.success("Account data exported successfully")}catch{n.error("Failed to export account data")}finally{P.value=!1}},O=async()=>{x.value=!0;try{const t=(await m.get("/auth/login-history")).data.data;let e='<div class="content"><h4>Login History</h4><ul>';t.forEach(r=>{e+=`<li><strong>${r.timestamp}</strong> - ${r.ip_address} (${r.user_agent})</li>`}),e+="</ul></div>";const u=document.createElement("div");u.innerHTML=`
      <div class="modal is-active">
        <div class="modal-background" onclick="this.parentElement.remove()"></div>
        <div class="modal-card">
          <header class="modal-card-head">
            <p class="modal-card-title">Login History</p>
            <button class="delete" onclick="this.closest('.modal').remove()"></button>
          </header>
          <section class="modal-card-body">${e}</section>
          <footer class="modal-card-foot">
            <button class="button" onclick="this.closest('.modal').remove()">Close</button>
          </footer>
        </div>
      </div>
    `,document.body.appendChild(u),n.success("Login history loaded")}catch{n.error("Failed to load login history")}finally{x.value=!1}},j=()=>{confirm("Are you sure you want to delete your account? This action cannot be undone.")&&B()},B=async()=>{try{await m.delete("/auth/account"),n.success("Account deleted successfully"),d.logout()}catch{n.error("Failed to delete account")}},M=a=>{switch(a){case"admin":return"is-danger";case"manager":return"is-warning";case"user":return"is-info";case"guest":return"is-light";default:return"is-light"}},T=async()=>{try{const a=await m.get("/auth/notifications");Object.assign(p,a.data.data)}catch{}};return H(()=>{T(),setInterval(()=>{const a=new Date,t=new Date(a.getTime()-2880*60*1e3-840*60*1e3),e=a-t,u=Math.floor(e/(1440*60*1e3)),r=Math.floor(e%(1440*60*1e3)/(3600*1e3));C.value=`${u} days ${r} hours`},6e4)}),(a,t)=>(w(),v("div",W,[s("div",X,[t[28]||(t[28]=s("div",{class:"columns"},[s("div",{class:"column"},[s("h1",{class:"title is-2 has-text-white mb-5"},[s("i",{class:"fas fa-cog mr-3"}),l(" Settings ")])])],-1)),s("div",Y,[s("div",Z,[s("div",ss,[t[12]||(t[12]=s("div",{class:"card-header"},[s("p",{class:"card-header-title has-text-white"},[s("i",{class:"fas fa-user mr-2"}),l(" Profile Settings ")])],-1)),s("div",ts,[s("div",es,[t[7]||(t[7]=s("label",{class:"label has-text-white"},"Username",-1)),s("div",as,[f(s("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>i.username=e),class:"input",type:"text",disabled:!c.value},null,8,os),[[g,i.username]])])]),s("div",ls,[t[8]||(t[8]=s("label",{class:"label has-text-white"},"Email",-1)),s("div",ns,[f(s("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>i.email=e),class:"input",type:"email",disabled:!c.value},null,8,is),[[g,i.email]])])]),s("div",rs,[t[9]||(t[9]=s("label",{class:"label has-text-white"},"Roles",-1)),s("div",ds,[(w(!0),v(R,null,I(J(d).user?.roles,e=>(w(),v("span",{key:e,class:b(["tag mr-1",M(e)])},A(e),3))),128))])]),s("div",cs,[s("div",us,[c.value?(w(),v("button",{key:1,class:b(["button is-success",{"is-loading":y.value}]),onClick:L},[...t[11]||(t[11]=[s("i",{class:"fas fa-save mr-2"},null,-1),l(" Save Changes ",-1)])],2)):(w(),v("button",{key:0,class:"button is-primary",onClick:N},[...t[10]||(t[10]=[s("i",{class:"fas fa-edit mr-2"},null,-1),l(" Edit Profile ",-1)])]))]),c.value?(w(),v("div",fs,[s("button",{class:"button",onClick:V}," Cancel ")])):z("",!0)])])]),s("div",ms,[t[17]||(t[17]=s("div",{class:"card-header"},[s("p",{class:"card-header-title has-text-white"},[s("i",{class:"fas fa-key mr-2"}),l(" Change Password ")])],-1)),s("div",ps,[s("div",hs,[t[13]||(t[13]=s("label",{class:"label has-text-white"},"Current Password",-1)),s("div",vs,[f(s("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>o.currentPassword=e),class:"input",type:"password",placeholder:"Enter current password"},null,512),[[g,o.currentPassword]])])]),s("div",ws,[t[14]||(t[14]=s("label",{class:"label has-text-white"},"New Password",-1)),s("div",gs,[f(s("input",{"onUpdate:modelValue":t[3]||(t[3]=e=>o.newPassword=e),class:"input",type:"password",placeholder:"Enter new password"},null,512),[[g,o.newPassword]])])]),s("div",bs,[t[15]||(t[15]=s("label",{class:"label has-text-white"},"Confirm New Password",-1)),s("div",ys,[f(s("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>o.confirmPassword=e),class:"input",type:"password",placeholder:"Confirm new password"},null,512),[[g,o.confirmPassword]])])]),s("div",_s,[s("div",Ps,[s("button",{class:b(["button is-warning",{"is-loading":_.value}]),onClick:D,disabled:!U.value},[...t[16]||(t[16]=[s("i",{class:"fas fa-key mr-2"},null,-1),l(" Change Password ",-1)])],10,xs)])])])]),s("div",ks,[t[20]||(t[20]=s("div",{class:"card-header"},[s("p",{class:"card-header-title has-text-white"},[s("i",{class:"fas fa-bell mr-2"}),l(" Notification Settings ")])],-1)),s("div",Cs,[s("div",Ss,[s("label",As,[f(s("input",{"onUpdate:modelValue":t[5]||(t[5]=e=>p.push=e),type:"checkbox",onChange:S},null,544),[[E,p.push]]),t[18]||(t[18]=l(" Push Notifications ",-1))])]),s("div",Es,[s("label",Us,[f(s("input",{"onUpdate:modelValue":t[6]||(t[6]=e=>p.lockAlerts=e),type:"checkbox",onChange:S},null,544),[[E,p.lockAlerts]]),t[19]||(t[19]=l(" Lock Status Alerts ",-1))])])])])]),s("div",Ns,[s("div",Vs,[t[23]||(t[23]=s("div",{class:"card-header"},[s("p",{class:"card-header-title has-text-white"},[s("i",{class:"fas fa-info-circle mr-2"}),l(" System Information ")])],-1)),s("div",Ls,[s("div",Ds,[t[22]||(t[22]=q('<p data-v-8b84b6ca><strong class="has-text-white" data-v-8b84b6ca>Version:</strong> 3.0.0</p><p data-v-8b84b6ca><strong class="has-text-white" data-v-8b84b6ca>Build:</strong> 2025.11.02</p><p data-v-8b84b6ca><strong class="has-text-white" data-v-8b84b6ca>Environment:</strong> Production</p><p data-v-8b84b6ca><strong class="has-text-white" data-v-8b84b6ca>Backend:</strong> Connected</p><p data-v-8b84b6ca><strong class="has-text-white" data-v-8b84b6ca>Database:</strong> Online</p>',5)),s("p",null,[t[21]||(t[21]=s("strong",{class:"has-text-white"},"Uptime:",-1)),l(" "+A(C.value),1)])])])]),s("div",Fs,[t[27]||(t[27]=s("div",{class:"card-header"},[s("p",{class:"card-header-title has-text-white"},[s("i",{class:"fas fa-shield-alt mr-2"}),l(" Account Security ")])],-1)),s("div",Os,[s("div",js,[s("button",{class:b(["button is-info is-fullwidth mb-3",{"is-loading":P.value}]),onClick:F},[...t[24]||(t[24]=[s("i",{class:"fas fa-download mr-2"},null,-1),l(" Export Account Data ",-1)])],2)]),s("div",Bs,[s("button",{class:b(["button is-warning is-fullwidth mb-3",{"is-loading":x.value}]),onClick:O},[...t[25]||(t[25]=[s("i",{class:"fas fa-history mr-2"},null,-1),l(" View Login History ",-1)])],2)]),s("div",{class:"field"},[s("button",{class:"button is-danger is-fullwidth",onClick:j},[...t[26]||(t[26]=[s("i",{class:"fas fa-trash mr-2"},null,-1),l(" Delete Account ",-1)])])])])])])])])]))}},Is=G(Ms,[["__scopeId","data-v-8b84b6ca"]]);export{Is as default};
