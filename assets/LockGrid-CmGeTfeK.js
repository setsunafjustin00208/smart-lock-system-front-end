import{z,A as d,B as n,c as y,v as m,f as e,n as v,t as p,e as I,F as j,j as U,y as V}from"./vendor-C24Hr-iP.js";import{u as q,f as E}from"./utils-D5aLFx-s.js";import{a as g,_ as N}from"./index-CVpvWM06.js";const G=z("locks",()=>{const a=q(),t=d([]),r=d([]),c=d(!1),k=d(null),u=d(null),f=d(null),b=n(()=>t.value.filter(s=>s.is_online)),L=n(()=>t.value.filter(s=>!s.is_online)),w=n(()=>t.value.filter(s=>s.status?.is_locked).length),C=n(()=>t.value.filter(s=>!s.status?.is_locked).length),i=n(()=>t.value.filter(s=>s.status?.battery_level<30)),h=async()=>{c.value=!0,k.value=null;try{const s=await g.get("/locks");t.value=s.data.data.map(o=>({...o,config:JSON.parse(o.config_data||"{}"),status:JSON.parse(o.status_data||"{}")}))}catch(s){k.value=s.response?.data?.message||"Failed to fetch locks",a.error("Failed to load locks"),console.error("Fetch locks error:",s)}finally{c.value=!1}},$=async()=>{try{const s=await g.get("/locks/status");r.value=s.data.data||[],t.value.forEach(o=>{const l=r.value.find(_=>_.lock_id===o.id);l&&(o.status=l.status,o.is_online=l.status==="online",o.last_updated=l.last_updated)})}catch(s){console.error("Fetch lock status error:",s)}},B=async s=>{const o=t.value.find(l=>l.id===s);if(o){if(!o.is_online){a.error("Cannot control offline lock");return}c.value=!0;try{const l=o.status?.is_locked?"unlock":"lock";if((await g.post(`/locks/${s}/control`,{action:l})).data.status==="success"){o.status.is_locked=!o.status.is_locked,o.status.last_activity=new Date().toISOString();const x=o.status.is_locked?"locked":"unlocked";a.success(`${o.name} ${x} successfully`)}await h()}catch(l){k.value=l.response?.data?.message||"Failed to control lock",a.error("Failed to control lock"),console.error("Toggle lock error:",l)}finally{c.value=!1}}},S=async(s,o)=>{try{if((await g.post(`/locks/${s}/control`,{action:o})).data.status==="success"){const _=t.value.find(x=>x.id===s)?.name||"Lock";return a.success(`${_} ${o}ed successfully`),await h(),!0}}catch(l){return console.error("Lock control error:",l),a.error(`Failed to ${o} lock`),!1}},O=async()=>{const s=t.value.filter(o=>!o.status?.is_locked&&o.is_online).map(o=>S(o.id,"lock"));await Promise.all(s)},T=async()=>{const s=t.value.filter(o=>o.status?.is_locked&&o.is_online).map(o=>S(o.id,"unlock"));await Promise.all(s)},A=()=>t.value.filter(s=>!s.is_online),D=()=>t.value.filter(s=>s.status?.battery_level&&s.status.battery_level<20),P=(s,o)=>{const l=t.value.find(_=>_.id===s);l&&Object.assign(l.status,o)},F=()=>{u.value||(u.value=setInterval(async()=>{await h()},3e4),f.value=setInterval(async()=>{await $()},1e4))};return{locks:t,lockStatus:r,loading:c,error:k,onlineLocks:b,offlineLocks:L,lockedCount:w,unlockedCount:C,lowBatteryLocks:i,fetchLocks:h,fetchLockStatus:$,toggleLock:B,controlLock:S,lockAll:O,unlockAll:T,getOfflineLocks:A,getLowBatteryLocks:D,updateLockStatus:P,startPolling:F,stopPolling:()=>{u.value&&(clearInterval(u.value),u.value=null),f.value&&(clearInterval(f.value),f.value=null)},startRealTimeUpdates:()=>{F()}}}),J={class:"card-content"},R={class:"lock-header"},H={class:"lock-icon-container"},K={class:"lock-info"},M={class:"lock-name"},Q={class:"lock-location"},W={class:"battery-display"},X={class:"battery-text"},Y={class:"lock-action"},Z=["disabled"],tt={key:0,class:"loading-spinner"},st={class:"lock-footer"},ot={class:"last-activity"},et={__name:"LockCard",props:{lock:{type:Object,required:!0}},setup(a){const t=a,r=G(),c=d(!1),k=n(()=>({"lock-card--locked":t.lock.status?.is_locked&&t.lock.is_online,"lock-card--unlocked":!t.lock.status?.is_locked&&t.lock.is_online,"lock-card--offline":!t.lock.is_online})),u=n(()=>({"lock-icon--locked":t.lock.status?.is_locked&&t.lock.is_online,"lock-icon--unlocked":!t.lock.status?.is_locked&&t.lock.is_online,"lock-icon--offline":!t.lock.is_online})),f=n(()=>({"status-indicator--online":t.lock.is_online,"status-indicator--offline":!t.lock.is_online})),b=n(()=>{const i=t.lock.status?.battery_level||0;return{"battery-high":i>50,"battery-medium":i>20&&i<=50,"battery-low":i<=20}}),L=n(()=>({"action-button--lock":!t.lock.status?.is_locked&&t.lock.is_online,"action-button--unlock":t.lock.status?.is_locked&&t.lock.is_online,"action-button--disabled":!t.lock.is_online})),w=async()=>{c.value=!0;try{await r.toggleLock(t.lock.id)}finally{c.value=!1}},C=i=>E(new Date(i),{addSuffix:!0});return(i,h)=>(m(),y("div",{class:v(["card lock-card animate-slide-in",k.value])},[e("div",J,[e("div",R,[e("div",H,[e("i",{class:v(["fas fa-lock lock-icon",u.value])},null,2),e("div",{class:v(["status-indicator",f.value])},null,2)]),e("div",K,[e("h3",M,p(a.lock.name),1),e("p",Q,p(a.lock.location),1)]),e("div",W,[e("i",{class:v(["fas fa-battery",b.value])},null,2),e("span",X,p(a.lock.status?.battery_level||0)+"%",1)])]),e("div",Y,[e("button",{class:v(["action-button",L.value]),onClick:w,disabled:c.value||!a.lock.is_online},[e("i",{class:v(a.lock.status?.is_locked?"fas fa-unlock":"fas fa-lock")},null,2),e("span",null,p(a.lock.status?.is_locked?"Unlock":"Lock"),1),c.value?(m(),y("div",tt)):I("",!0)],10,Z)]),e("div",st,[e("span",ot,p(C(a.lock.status?.last_activity||a.lock.updated_at)),1)])])],2))}},at=N(et,[["__scopeId","data-v-88f751a8"]]),lt={class:"lock-grid"},ct={class:"columns is-multiline"},nt={key:0,class:"has-text-centered py-6"},it={__name:"LockGrid",props:{locks:{type:Array,required:!0}},setup(a){return(t,r)=>(m(),y("div",lt,[e("div",ct,[(m(!0),y(j,null,U(a.locks,c=>(m(),y("div",{key:c.id,class:"column is-12-mobile is-6-tablet is-4-desktop is-3-widescreen"},[V(at,{lock:c},null,8,["lock"])]))),128))]),a.locks.length===0?(m(),y("div",nt,[...r[0]||(r[0]=[e("i",{class:"fas fa-lock is-size-1 has-text-white-ter mb-4"},null,-1),e("p",{class:"has-text-white-ter is-size-5"},"No locks found",-1),e("p",{class:"has-text-white-ter"},"Add your first smart lock to get started",-1)])])):I("",!0)]))}},_t=N(it,[["__scopeId","data-v-e482f460"]]);export{_t as L,G as u};
